أهلاً بك. أدرك تماماً مدى القلق الذي يسببه الشعور بأن سيرفرك مخترق أو يحتوي على برمجيات خبيثة. لا تقلق، سنتعامل مع الأمر خطوة بخطوة.

ملاحظة سريعة: Debian 13 (Trixie) لا يزال حالياً في المرحلة التجريبية (Testing)، لذا قد تجد بعض الأدوات تعمل بشكل مختلف قليلاً عن النسخ المستقرة، لكن الخطوات الأساسية تظل واحدة.

إليك دليل عملي للبحث عن البرمجيات الخبيثة وتحديدها:

1. مراقبة العمليات والاتصالات النشطة
أول خطوة هي معرفة ما الذي يعمل الآن ومن يتصل بالسيرفر.

فحص استهلاك الموارد: استخدم أمر top أو htop (إذا لم يكن مثبتاً، ثبته بـ sudo apt install htop). ابحث عن عمليات تستهلك المعالج (CPU) بنسبة عالية جداً أو لها أسماء غريبة.

فحص الاتصالات الشبكية: لمعرفة ما إذا كان السيرفر يرسل بيانات لجهة خارجية:

```Bash
sudo ss -tulpn
```
ابحث عن أي IP خارجي غير مألوف متصل بسيرفرك، خاصة على بورتات غير معروفة.

2. استخدام أدوات فحص البرمجيات الخبيثة (Malware Scanners)
هناك أدوات متخصصة لنظام لينكس تعتبر الأفضل في هذا المجال:

أ- أداة Chkrootkit و Rkhunter
هذه الأدوات تبحث عن "الروتكيت" (Rootkits) وهي برمجيات تختبئ في أعماق النظام.

لتثبيتهما:

```Bash
sudo apt update && sudo apt install chkrootkit rkhunter -y
```
للتشغيل:

```Bash
sudo chkrootkit
sudo rkhunter --check
```
ب- أداة ClamAV
وهي أشهر مضاد فيروسات مفتوح المصدر للينكس.

التثبيت: 
```Bash
sudo apt install clamav clamav-daemon -y
```
تحديث القاعدة: 
```Bash
sudo freshclam
```
فحص السيرفر بالكامل:

```Bash
sudo clamscan -r -i / 
```
(ملاحظة: خيار -i سيظهر لك الملفات المصابة فقط).

3. فحص ملفات النظام والملفات المعدلة حديثاً
البرمجيات الخبيثة غالباً ما تعدل ملفات النظام أو تضع ملفات جديدة. يمكنك البحث عن الملفات التي تم تعديلها في آخر يومين مثلاً:
```Bash
sudo find / -mtime -2 -ls
```
أيضاً، تحقق من ملفات Cron Jobs (المهام المجدولة) لأن المخترقين يستخدمونها لضمان عودة البرمجية للعمل حتى بعد حذفها:
```Bash
ls -la /etc/cron.*
crontab -l
```
4. مراجعة سجلات النظام (Logs)
السجلات هي "الصندوق الأسود" للسيرفر. ابحث عن محاولات تسجيل دخول فاشلة أو غريبة:

سجل الدخول: 
```Bash
cat /var/log/auth.log | grep "Failed"
```

سجل النظام العام: 
```Bash
tail -f /var/log/syslog
```

5. تثبيت UFW (Uncomplicated Firewall)
```Bash
sudo ufw allow OpenSSH
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

sudo systemctl enable fail2ban --now




نتائج فحص الـ Cron للنظام (System-wide) التي أرسلتها نظيفة جداً وتبدو كإعدادات افتراضية لنظام Debian مستقر. لا توجد أي مدخلات مريبة في /etc/crontab أو /etc/cron.daily.

هذا يعني أن "النشاط" الذي تشك فيه لا يختبئ في ملفات النظام الأساسية، بل ينحصر في حساب المستخدم go أو ملفات لوحة التحكم (إذا كنت تستخدم واحدة).

إليك الخطوات التالية لتضييق الخناق على أي برمجية خبيثة:

1. تحليل ملفات المستخدم go (النقطة الأهم)
بما أن الـ Crontab الخاص بالمستخدم go يحتوي على هذا الملف: /www/server/cron/a50afd8f7d0e95dc2fd7bbbcfdcccd82

هذا المسار ( /www/server/ ) يؤكد بنسبة 99% وجود لوحة تحكم aaPanel أو BT-Panel. إذا لم تكن قد ثبتّ هذه اللوحة بنفسك، فهذه هي المشكلة. أما إذا كنت تستخدمها، فالمخترقون أحياناً يستغلون ثغرات في هذه اللوحة تحديداً.

قم بتنفيذ هذا الأمر لعرض محتوى الملف:

Bash
sudo cat /www/server/cron/a50afd8f7d0e95dc2fd7bbbcfdcccd82
(إذا رأيت كود PHP أو أوامر Shell غير مفهومة، فقم بنسخها هنا).

2. فحص "سلامة" ملفات النظام (Binary Integrity)
أحياناً يقوم المخترق باستبدال أوامر النظام (مثل ls أو ps) بنسخ خبيثة تخفي وجوده. للتأكد من أن أوامر النظام في Debian لم تُلمس، سنستخدم أداة debsums:

تثبيت الأداة:

```bash
sudo apt install debsums -y
```
فحص الملفات التنفيذية:

```bash
sudo debsums -c
```
إذا لم تظهر أي نتائج، فكل شيء سليم. إذا ظهرت أسماء ملفات، فهذا يعني أنها عُدلت خارج إطار التحديثات الرسمية.




نتائج فحص الـ Cron للنظام (System-wide) التي أرسلتها نظيفة جداً وتبدو كإعدادات افتراضية لنظام Debian مستقر. لا توجد أي مدخلات مريبة في /etc/crontab أو /etc/cron.daily.

هذا يعني أن "النشاط" الذي تشك فيه لا يختبئ في ملفات النظام الأساسية، بل ينحصر في حساب المستخدم go أو ملفات لوحة التحكم (إذا كنت تستخدم واحدة).

إليك الخطوات التالية لتضييق الخناق على أي برمجية خبيثة:

1. تحليل ملفات المستخدم go (النقطة الأهم)
بما أن الـ Crontab الخاص بالمستخدم go يحتوي على هذا الملف: /www/server/cron/a50afd8f7d0e95dc2fd7bbbcfdcccd82

هذا المسار ( /www/server/ ) يؤكد بنسبة 99% وجود لوحة تحكم aaPanel أو BT-Panel. إذا لم تكن قد ثبتّ هذه اللوحة بنفسك، فهذه هي المشكلة. أما إذا كنت تستخدمها، فالمخترقون أحياناً يستغلون ثغرات في هذه اللوحة تحديداً.

قم بتنفيذ هذا الأمر لعرض محتوى الملف:

Bash
sudo cat /www/server/cron/a50afd8f7d0e95dc2fd7bbbcfdcccd82
(إذا رأيت كود PHP أو أوامر Shell غير مفهومة، فقم بنسخها هنا).

2. فحص "سلامة" ملفات النظام (Binary Integrity)
أحياناً يقوم المخترق باستبدال أوامر النظام (مثل ls أو ps) بنسخ خبيثة تخفي وجوده. للتأكد من أن أوامر النظام في Debian لم تُلمس، سنستخدم أداة debsums:

تثبيت الأداة:

Bash
sudo apt install debsums -y
فحص الملفات التنفيذية:

Bash
sudo debsums -c
إذا لم تظهر أي نتائج، فكل شيء سليم. إذا ظهرت أسماء ملفات، فهذا يعني أنها عُدلت خارج إطار التحديثات الرسمية.

3. البحث عن "العمليات المحذوفة" (Deleted Executables)
من الحيل الذكية للبرمجيات الخبيثة أنها تعمل في الذاكرة ثم تحذف الملف الأصلي من الهاردسك لكي لا يجدها أي فاحص. يمكنك كشفها بهذا الأمر:

Bash
sudo ls -al /proc/*/exe | grep deleted
إذا رأيت عمليات تشير إلى ملفات (deleted)، فهذه برمجية تعمل حالياً في الذاكرة وهي "مختبئة".

4. ملاحظة بخصوص debsecan
لاحظت وجود ملف باسم debsecan في نتائجك. هذه أداة تبحث عن الثغرات الأمنية في الحزم المثبتة.

هل قمت بتثبيتها؟ إذا كان الجواب لا، فقد تكون ميزة أمنية من Hostinger أو أن السيرفر تم "تطعيمه" مسبقاً. هي أداة مفيدة وليست ضارة.

5. فحص الـ SSH Keys (الباب الخلفي)
بما أنك أكدت أن المستخدمين يخصونك، يجب أن نتأكد أن المخترق لم يضع "مفتاحه" الخاص للدخول بدون كلمة مرور:

```Bash
sudo cat /home/go/.ssh/authorized_keys
sudo cat /root/.ssh/authorized_keys
```
هل ترى أي مفتاح (نص طويل ينتهي بإيميل أو اسم جهاز) لا تعرفه؟


```Bash
sudo apt install fail2ban -y
sudo systemctl start fail2ban
sudo systemctl enable fail2ban
sudo systemctl restart fail2ban
sudo systemctl status fail2ban

sudo fail2ban-client status
sudo mkdir -p /var/run/fail2ban
sudo systemctl restart fail2ban
sudo fail2ban-server -xf start
```
```bash
sudo apt update && sudo apt install htop -y
htop
```
أداة Fail2Ban تعمل بشكل تلقائي بمجرد تثبيتها، حيث تبدأ بمراقبة سجلات النظام (Logs) بحثاً عن محاولات الدخول الفاشلة. بمجرد أن يخطئ شخص ما في كلمة المرور عدة مرات، يقوم البرنامج بإضافة عنوان الـ IP الخاص به إلى القائمة السوداء في جدار الحماية (UFW) الذي فعلناه للتو.

إليك كيفية تشغيلها والتأكد من أنها تعمل بكفاءة:

1. تشغيل الخدمة وتفعيلها
بعد التثبيت، تأكد من أن الخدمة تعمل وتبدأ مع تشغيل السيرفر تلقائياً:

Bash
sudo systemctl start fail2ban
sudo systemctl enable fail2ban
2. التحقق من الحالة (الوضع الافتراضي)
بشكل افتراضي، يقوم Fail2Ban بتفعيل حماية الـ SSH فوراً. يمكنك التحقق من ذلك بالأمر التالي:

Bash
sudo fail2ban-client status
ستظهر لك قائمة بالـ "Jails" (السجون) النشطة، ويجب أن ترى sshd من ضمنها.

3. تخصيص الإعدادات (اختياري ولكن يُنصح به)
إذا أردت تغيير عدد المحاولات المسموح بها أو مدة الحظر، يفضل دائماً إنشاء ملف إعدادات محلي بدلاً من التعديل على الملف الأصلي:

قم بنسخ ملف الإعدادات:

Bash
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
افتح الملف للتعديل:

Bash
sudo nano /etc/fail2ban/jail.local
ابحث عن القيم التالية وعدلها حسب رغبتك:

bantime: المدة التي سيتم حظر الـ IP فيها (مثلاً 1h لساعة واحدة).

findtime: الفترة الزمنية التي يتم فيها حساب عدد المحاولات الفاشلة.

maxretry: عدد المحاولات الفاشلة المسموح بها قبل الحظر (مثلاً 3).

4. كيف تعرف من تم حظره؟
إذا أردت رؤية قائمة بـ "المجرمين" الذين حاولوا دخول سيرفرك وتم حظرهم حالياً:

Bash
sudo fail2ban-client status sshd
سيظهر لك عدد الـ IPs المحظورة حالياً وعناوينها.

5. فك الحظر عن IP معين
إذا أخطأت أنت في كلمة المرور وتم حظرك بالخطأ، يمكنك فك الحظر عن نفسك من جهاز آخر عبر هذا الأمر:

Bash
sudo fail2ban-client set sshd unbanip IP_ADDRESS
(استبدل IP_ADDRESS بالعنوان المراد فك حظره).

ملخص الوضع الآن:
سيرفرك الآن محمي بثلاث طبقات:

جدار حماية (UFW): يغلق كل الأبواب غير الضرورية.

برنامج Fail2Ban: يطرد أي شخص يحاول تخمين كلمة المرور.

نظام نظيف: بعد أن تخلصنا من بقايا aaPanel والمهام المجدولة المشبوهة.

هل تريد مني المساعدة في إعداد تنبيهات تصلك على الإيميل في حال تم حظر أي IP، أم تكتفي بالحماية الصامتة الحالية؟